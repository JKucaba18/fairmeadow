<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fairmeadow Country Club</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <meta name="theme-color" content="#15803d" />
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-green-50 text-gray-800">
  <header class="bg-green-700 text-white p-4 shadow">
    <h1 class="text-2xl font-bold text-center">Fairmeadow Country Club</h1>
    <nav class="flex justify-center mt-2 space-x-4">
      <a href="#home" class="hover:underline">Home</a>
      <a href="#scoreboard" class="hover:underline">Scoreboard</a>
      <a href="#map" class="hover:underline">Course Map</a>
      <a href="#gallery" class="hover:underline">Gallery</a>
      <a href="#stats" class="hover:underline">Stats</a>
      <a href="#post" class="hover:underline">Post Round</a>
    </nav>
  </header>

  <!-- Home -->
  <section id="home" class="p-8 text-center">
    <h2 class="text-xl font-semibold">Welcome to Fairmeadow CC</h2>
    <p class="mt-2">7-hole backyard golf course. Compete, track scores, and have fun with friends.</p>
  </section>

  <!-- Scoreboard -->
  <section id="scoreboard" class="p-8">
    <h2 class="text-xl font-semibold mb-4">Scoreboard</h2>
    <table class="w-full table-auto border">
      <thead>
        <tr class="bg-green-200">
          <th class="border p-2">Player</th>
          <th class="border p-2">Total Rounds</th>
          <th class="border p-2">Avg Score</th>
          <th class="border p-2">Handicap</th>
        </tr>
      </thead>
      <tbody id="scoreData">
        <!-- Populated by script -->
      </tbody>
    </table>
  </section>

  <!-- Course Map -->
  <section id="map" class="p-8">
    <h2 class="text-xl font-semibold mb-4">Course Map</h2>
    <p>Coming soon: Visual layout of all 7 holes.</p>
  </section>

  <!-- Gallery -->
  <section id="gallery" class="p-8">
    <h2 class="text-xl font-semibold mb-4">Photo Gallery</h2>
    <p>Upload and view photos coming soon.</p>
  </section>

  <!-- Stats -->
  <section id="stats" class="p-8">
    <h2 class="text-xl font-semibold mb-4">Stats</h2>
    <ul class="list-disc ml-6">
      <li>Most Birdies: Player 2 (5)</li>
      <li>Best Round: Player 1 (24 strokes)</li>
      <li>Most Played: Player 3 (6 rounds)</li>
    </ul>
  </section>

  <!-- Post Round -->
  <section id="post" class="p-8" x-data="{ password: '', showForm: false, form: { player: '', score: '', caption: '' }, message: '' }">
    <h2 class="text-xl font-semibold mb-4">Post a Round</h2>
    <template x-if="!showForm">
      <div>
        <p>Enter password to post:</p>
        <input type="password" x-model="password" class="border p-2 mt-2">
        <button @click="if (password === 'fairmeadow123') showForm = true" class="ml-2 px-4 py-2 bg-green-600 text-white rounded">Submit</button>
      </div>
    </template>
    <template x-if="showForm">
      <form @submit.prevent="
        fetch('https://script.google.com/macros/s/AKfycbwq1K57T66DPxPBAPLvQI7k00RjnzTVLDpljRAsilHAxZbQ_pcB3qZ8dO50p9YEBJZSZQ/exec', {
          method: 'POST',
          body: JSON.stringify(form)
        })
        .then(() => message = 'Round posted!')
        .catch(() => message = 'Failed to post.');
      " class="mt-4">
        <label class="block mb-2">Player Name</label>
        <input type="text" x-model="form.player" class="border p-2 w-full mb-4">
        <label class="block mb-2">Score</label>
        <input type="number" x-model="form.score" class="border p-2 w-full mb-4">
        <label class="block mb-2">Caption</label>
        <textarea x-model="form.caption" class="border p-2 w-full mb-4"></textarea>
        <button type="submit" class="px-4 py-2 bg-green-700 text-white rounded">Post Round</button>
        <p x-text="message" class="mt-2 text-sm text-green-700"></p>
      </form>
    </template>
  </section>

  <footer class="bg-green-700 text-white p-4 text-center mt-8">
    <p>&copy; 2025 Fairmeadow Country Club</p>
  </footer>

  <!-- Live Scoreboard Script -->
  <script>
    async function loadScores() {
      const response = await fetch("https://docs.google.com/spreadsheets/d/1h7iREE5f3vm2aa1-wIV3lwhQ6plYCYF8MIZMCE4etz0/gviz/tq?tqx=out:csv");
      const csvText = await response.text();
      const rows = csvText.trim().split("\n").slice(1);

      const players = {};
      for (const row of rows) {
        const [timestamp, name, scoreText] = row.split(",");
        const score = parseInt(scoreText);
        if (!name || isNaN(score)) continue;

        if (!players[name]) players[name] = [];
        players[name].push(score);
      }

      const tbody = document.getElementById("scoreData");
      tbody.innerHTML = "";

      const coursePar = 22;

      for (const [name, scores] of Object.entries(players)) {
        const rounds = scores.length;
        const total = scores.reduce((a, b) => a + b, 0);
        const avg = (total / rounds).toFixed(1);
        const handicap = Math.round(((avg - coursePar) * 0.9) * 10) / 10;

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="border p-2">${name}</td>
          <td class="border p-2">${rounds}</td>
          <td class="border p-2">${avg}</td>
          <td class="border p-2">${handicap >= 0 ? "+" + handicap : handicap}</td>
        `;
        tbody.appendChild(tr);
      }
    }

    window.onload = loadScores;
  </script>
</body>
</html>
